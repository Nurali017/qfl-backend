# Задачи для бэкенд-разработчика: мульти-турнир (header-фильтр)

Фронт переключает турниры (Премьер-лига 61, Первая лига 62, Кубок 63, Вторая лига 65, Женщины 66) и шлёт в API `season_id` в пути или в query. Ниже — только задачи по бэкенду.

---

## 1. Документация API

- В **`docs/API_FRONTEND.md`** явно указать: для мульти-турнира фронт всегда передаёт `season_id` в запросах к `GET /games`, `GET /teams/*`, `GET /players/*` (где параметр есть). При отсутствии параметра бэкенд использует текущий сезон (61).
- Опционально: в описании `GET /games` и остальных таких эндпоинтов добавить пример с `season_id` (например, `?season_id=63` для кубка).

---

## 2. Данные в БД

- Убедиться, что в таблице **`seasons`** есть записи с id 61, 62, 63, 65, 66 (соответствуют турнирам из конфига фронта). При необходимости — миграция или сид.
- По каждому нужному сезону должны заполняться: games, score_table (для лиг), при необходимости player_season_stats, team_season_stats.

---

## 3. Синк по всем сезонам

- Либо описать в README/доках ручной запуск: `POST /api/v1/sync/full?season_id=62`, `?season_id=63` и т.д. для каждого сезона.
- Либо доработать синк: в конфиг или .env добавить список season_id (например, 61,62,63,65,66) и в сервисе/эндпоинте по очереди вызывать full_sync по каждому.

---

## 4. Celery / фоновые задачи

- Сейчас в **`app/tasks/sync_tasks.py`** используется только `settings.current_season_id` (61).
- Либо добавить в конфиг список сезонов и в задаче по расписанию вызывать full_sync по каждому season_id.
- Либо зафиксировать в документации: по умолчанию синнится только текущий сезон (61), остальные — вручную или скриптом.

---

## 5. Тесты (по желанию)

- Интеграционный тест: для двух разных `season_id` (например, 61 и 63), по которым в тестовой БД есть данные, проверить, что `GET /seasons/{id}/table` и `GET /seasons/{id}/games` возвращают разные данные (разные season_id в ответах или разный состав).

---

**Контекст:** эндпоинты `GET /seasons/{season_id}/table`, `/results-grid`, `/games`, `/player-stats`, `/team-stats`, `/statistics` уже корректно работают с переданным в path сезоном. Дефолт 61 используется только в `GET /games`, `/teams/*`, `/players/*` при отсутствии query-параметра `season_id`.
